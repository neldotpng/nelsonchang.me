{"ast":null,"code":"import _classCallCheck from \"/Users/Nelson/GitHub/nelsonchang.me/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/Nelson/GitHub/nelsonchang.me/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/Nelson/GitHub/nelsonchang.me/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/Nelson/GitHub/nelsonchang.me/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/Nelson/GitHub/nelsonchang.me/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/Nelson/GitHub/nelsonchang.me/src/components/TextCanvas.js\";\nimport React, { Component } from 'react';\nimport { TweenMax, Sine } from 'gsap';\nimport Particle from './Particle';\nimport debounce from '../functions/debounce';\nimport { isMobileDevice } from '../functions/browser-detect';\n\nvar TextCanvas =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(TextCanvas, _Component);\n\n  function TextCanvas() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, TextCanvas);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(TextCanvas)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      isMobile: isMobileDevice(),\n      width: window.innerWidth,\n      height: window.innerHeight,\n      dpi: 2,\n      words: ['장수영', '나는', '마르케', '오디세이', '트렁크', '이것저것', '다음'],\n      size: {\n        max: 25,\n        grid: 23,\n        min: 21\n      },\n      fontSize: '140vh',\n      fontFamily: 'Black Han Sans',\n      i: 0,\n      vertical: false,\n      timer: null\n    };\n\n    _this.init = function () {\n      _this.canvas = document.getElementById('canvas');\n      _this.ctx = _this.canvas.getContext('2d');\n      _this.txtCanv = document.createElement('canvas');\n      _this.txtCtx = _this.txtCanv.getContext('2d');\n      _this.txtCtx.fillStyle = 'black';\n    };\n\n    _this.setValues = function () {\n      _this.canvas.width = _this.state.width * _this.state.dpi;\n      _this.canvas.height = _this.state.height * _this.state.dpi;\n      _this.particles = [];\n      _this.txtCanv.width = _this.canvas.width;\n      _this.txtCanv.height = _this.canvas.height;\n      _this.txtCtx.textBaseline = 'middle';\n      _this.txtCtx.font = \"\".concat(_this.state.fontSize, \" \").concat(_this.state.fontFamily);\n\n      if (!_this.state.vertical) {\n        _this.getPixels(_this.state.words[_this.state.i]);\n      } else {\n        _this.getPixelsV(_this.state.words[_this.state.i]);\n      }\n\n      _this.makeParticles();\n\n      _this.animate();\n    };\n\n    _this.makeParticles = function () {\n      for (var i = 0; i < _this.positions.length; i++) {\n        if (!!_this.positions[i]) {\n          _this.particles.push(new Particle(_this.state.width, Math.pow(i, 1.3) * Math.sin(i), _this.positions[i].x, _this.positions[i].y, _this.ctx, _this.state.size.min));\n        }\n      }\n    };\n\n    _this.addParticles = function () {\n      var nta = _this.positions.length - _this.particles.length;\n\n      for (var i = 0; i <= nta; i++) {\n        _this.particles.push(new Particle(_this.canvas.width / 2, i + _this.canvas.height / 2, _this.canvas.width / 2, i + _this.canvas.height / 2, _this.ctx, _this.state.size.min));\n      }\n    };\n\n    _this.removeParticles = function () {\n      var newArr = _this.particles.slice(0, _this.positions.length);\n\n      _this.particles = newArr;\n    };\n\n    _this.getPixels = function (keyword) {\n      _this.txtCtx.clearRect(0, 0, _this.txtCanv.width, _this.txtCanv.height);\n\n      _this.txtCtx.fillText(keyword, _this.txtCanv.width / 2 - _this.txtCtx.measureText(keyword).width / 2, _this.txtCanv.height / 2);\n\n      var imgData = _this.txtCtx.getImageData(0, 0, _this.txtCanv.width, _this.txtCanv.height);\n\n      var buffer32 = new Uint32Array(imgData.data.buffer);\n      _this.positions = [];\n\n      for (var y = 0; y < _this.txtCanv.height; y += _this.state.size.grid) {\n        for (var x = 0; x < _this.txtCanv.width; x += _this.state.size.grid) {\n          if (buffer32[y * _this.txtCanv.width + x]) {\n            _this.positions.push({\n              x: x,\n              y: y\n            });\n          }\n        }\n      }\n\n      var diff = (_this.canvas.height - _this.positions[_this.positions.length - 1].y - _this.positions[0].y) / 2;\n\n      _this.positions.forEach(function (p) {\n        p.y += diff;\n      });\n    };\n\n    _this.getPixelsV = function (keyword) {\n      _this.txtCtx.clearRect(0, 0, _this.txtCanv.width, _this.txtCanv.height);\n\n      _this.txtCtx.textBaseline = 'top';\n      var p;\n\n      if (keyword.length >= 3) {\n        _this.setState({\n          fontSize: \"\".concat(110 / keyword.length * _this.state.dpi, \"vh\")\n        }, function () {\n          _this.txtCtx.font = \"\".concat(_this.state.fontSize, \" \").concat(_this.state.fontFamily);\n        });\n\n        p = 1 / keyword.length;\n      } else {\n        _this.setState({\n          fontSize: \"\".concat(80 / keyword.length * _this.state.dpi, \"vh\")\n        }, function () {\n          _this.txtCtx.font = \"\".concat(_this.state.fontSize, \" \").concat(_this.state.fontFamily);\n        });\n\n        p = 0.4;\n      }\n\n      for (var i = 0; i < keyword.length; i++) {\n        _this.txtCtx.fillText(keyword[i], i * (_this.txtCanv.width / ((keyword.length + 1) / 2) - _this.txtCtx.measureText(keyword[i]).width / 2), i * (_this.txtCanv.height * p));\n      }\n\n      var imgData = _this.txtCtx.getImageData(0, 0, _this.txtCanv.width, _this.txtCanv.height);\n\n      var buffer32 = new Uint32Array(imgData.data.buffer);\n      _this.positions = [];\n\n      for (var y = 0; y < _this.txtCanv.height; y += _this.state.size.grid) {\n        for (var x = 0; x < _this.txtCanv.width; x += _this.state.size.grid) {\n          if (buffer32[y * _this.txtCanv.width + x]) {\n            _this.positions.push({\n              x: x,\n              y: y\n            });\n          }\n        }\n      }\n\n      var diff;\n\n      if (keyword.length >= 3) {\n        diff = _this.positions[0].y / -1;\n      } else {\n        diff = (_this.canvas.height - _this.positions[_this.positions.length - 1].y - _this.positions[0].y) / 2;\n      }\n\n      _this.positions.forEach(function (p) {\n        p.y += diff;\n      });\n    };\n\n    _this.animateParticles = function () {\n      _this.positions.forEach(function (p, i) {\n        _this.particles[i].move(_this.mx, _this.my);\n\n        _this.particles[i].draw();\n      });\n    };\n\n    _this.changeWord = function () {\n      // TweenMax.killAll(true);\n      if (!_this.state.vertical) {\n        _this.getPixels(_this.state.words[_this.state.i]);\n      } else {\n        _this.getPixelsV(_this.state.words[_this.state.i]);\n      }\n\n      if (_this.positions.length > _this.particles.length) {\n        _this.addParticles();\n      } else {\n        _this.removeParticles();\n      }\n\n      _this.positions.forEach(function (p, i) {\n        _this.particles[i].homeX = p.x;\n        _this.particles[i].homeY = p.y;\n      }); // this.tweenSize();\n\n    };\n\n    _this.animate = debounce(function () {\n      _this.ctx.clearRect(0, 0, _this.canvas.width, _this.canvas.height);\n\n      _this.animateParticles();\n\n      _this.animation = requestAnimationFrame(_this.animate);\n    }, 1000 / 60);\n\n    _this.tweenSize = function () {\n      var t = 3.5,\n          l = _this.particles.length;\n\n      _this.particles.forEach(function (p, i) {\n        TweenMax.to(p, t, {\n          radius: _this.state.size.max,\n          homeX: !_this.state.isMobile ? p.getX() + 20 : p.getX() + 10,\n          homeY: !_this.state.isMobile ? p.getY() + 30 : p.getY() + 15,\n          delay: t / l * i,\n          yoyo: true,\n          repeat: -1,\n          easing: Sine.easeInOut\n        });\n      });\n    };\n\n    _this.resetTween = function () {\n      _this.setValues();\n\n      TweenMax.killAll(true);\n\n      _this.tweenSize();\n    };\n\n    _this.onMouseMove = function (e) {\n      _this.mx = (e.clientX - _this.canvas.offsetLeft) * _this.state.dpi;\n      _this.my = (e.clientY - _this.canvas.offsetTop) * _this.state.dpi;\n    };\n\n    _this.onResize = function () {\n      if (_this.state.width !== window.innerWidth || _this.state.height !== window.innerHeight && _this.state.width > 768) {\n        _this.setCanvasState();\n      }\n    };\n\n    _this.setCanvasState = function () {\n      _this.setState({\n        width: window.innerWidth,\n        height: window.innerHeight\n      }, function () {\n        if (_this.state.width >= 1600) {\n          _this.setState({\n            size: {\n              max: 14.5 * _this.state.dpi,\n              grid: 14 * _this.state.dpi,\n              min: 13.5 * _this.state.dpi\n            },\n            fontSize: \"\".concat(70 * _this.state.dpi, \"vh\"),\n            vertical: false\n          }, _this.setValues);\n        } else if (_this.state.width < 1600 && _this.state.width >= 1080) {\n          _this.setState({\n            size: {\n              max: 12 * _this.state.dpi,\n              grid: 11.5 * _this.state.dpi,\n              min: 11 * _this.state.dpi\n            },\n            fontSize: \"\".concat(65 * _this.state.dpi, \"vh\"),\n            vertical: false\n          }, _this.setValues);\n        } else if (_this.state.width < 1080 && _this.state.width >= 768) {\n          _this.setState({\n            size: {\n              max: 9.5 * _this.state.dpi,\n              grid: 9 * _this.state.dpi,\n              min: 8.5 * _this.state.dpi\n            },\n            fontSize: \"\".concat(60 * _this.state.dpi, \"vh\"),\n            vertical: false\n          }, _this.setValues);\n        } else if (_this.state.width < 768 && _this.state.width >= 480) {\n          _this.setState({\n            size: {\n              max: 7.5 * _this.state.dpi,\n              grid: 7 * _this.state.dpi,\n              min: 6.5 * _this.state.dpi\n            },\n            fontSize: \"\".concat(60 * _this.state.dpi, \"vh\"),\n            vertical: false\n          }, _this.setValues);\n        } else {\n          _this.setState({\n            size: {\n              max: 7.5 * _this.state.dpi,\n              grid: 7 * _this.state.dpi,\n              min: 6.5 * _this.state.dpi\n            },\n            fontSize: \"\".concat(40 * _this.state.dpi, \"vh\"),\n            vertical: true\n          }, _this.setValues);\n        }\n      });\n    };\n\n    _this.onScroll = function () {\n      _this.props.setHasBackground(true);\n\n      clearTimeout(_this.state.timer);\n\n      _this.setState({\n        timer: setTimeout(function () {\n          _this.props.setHasBackground(false);\n\n          _this.resetTween();\n        }, 7500)\n      });\n    };\n\n    _this.onScrollToBottom = function () {\n      _this.updateWord(6, 0);\n    };\n\n    _this.onScrollUp = function () {\n      _this.updateCanvas(_this.props.location, 0);\n    };\n\n    _this.initWord = function () {\n      switch (_this.props.location) {\n        default:\n        case '/':\n          _this.setState({\n            i: 0\n          });\n\n          break;\n\n        case '/about':\n          _this.setState({\n            i: 1\n          });\n\n          break;\n\n        case '/marquee-sports':\n          _this.setState({\n            i: 2\n          });\n\n          break;\n\n        case '/odyssey':\n          _this.setState({\n            i: 3\n          });\n\n          break;\n\n        case '/trunk-club':\n          _this.setState({\n            i: 4\n          });\n\n          break;\n\n        case '/ar-vr':\n          _this.setState({\n            i: 5\n          });\n\n          break;\n      }\n    };\n\n    _this.updateWord = function (i, t) {\n      _this.setState({\n        i: i\n      }, function () {\n        _this.props.getBgText(_this.state.words[_this.state.i]);\n\n        setTimeout(function () {\n          _this.changeWord();\n        }, t);\n      });\n    };\n\n    _this.updateCanvas = function (location, t) {\n      switch (location) {\n        default:\n        case '/':\n          _this.updateWord(0, t);\n\n          break;\n\n        case '/about':\n          _this.updateWord(1, t);\n\n          break;\n\n        case '/marquee-sports':\n          _this.updateWord(2, t);\n\n          break;\n\n        case '/odyssey':\n          _this.updateWord(3, t);\n\n          break;\n\n        case '/trunk-club':\n          _this.updateWord(4, t);\n\n          break;\n\n        case '/etc':\n          _this.updateWord(5, t);\n\n          break;\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(TextCanvas, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.location !== this.props.location) {\n        this.updateCanvas(this.props.location, 250);\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.init();\n      this.initWord();\n      setTimeout(function () {\n        _this2.updateCanvas(_this2.props.location);\n\n        _this2.setCanvasState();\n      }, 1500);\n      window.addEventListener('resize', debounce(this.onResize, 1000 / 5));\n\n      if (!this.state.isMobile) {\n        window.addEventListener('mousemove', this.onMouseMove);\n        window.addEventListener('scroll', debounce(this.onScroll, 1000 / 30));\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: \"canvas\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 412\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          fontFamily: 'Black Han Sans',\n          fontSize: '1px',\n          color: '#EFEFEF'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 413\n        },\n        __self: this\n      }, \"\\uC7A5\\uC218\\uC601 \\uB098\\uB294 \\uB9C8\\uB974\\uCF00 \\uC624\\uB514\\uC138\\uC774 \\uD2B8\\uB801\\uD06C \\uC774\\uAC83\\uC800\\uAC83 \\uB2E4\\uC74C\"), React.createElement(\"canvas\", {\n        id: \"canvas\",\n        className: \"shared__canvas\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 420\n        },\n        __self: this\n      }, this.state.words[this.state.i]));\n    }\n  }]);\n\n  return TextCanvas;\n}(Component);\n\nexport default TextCanvas;","map":{"version":3,"sources":["/Users/Nelson/GitHub/nelsonchang.me/src/components/TextCanvas.js"],"names":["React","Component","TweenMax","Sine","Particle","debounce","isMobileDevice","TextCanvas","state","isMobile","width","window","innerWidth","height","innerHeight","dpi","words","size","max","grid","min","fontSize","fontFamily","i","vertical","timer","init","canvas","document","getElementById","ctx","getContext","txtCanv","createElement","txtCtx","fillStyle","setValues","particles","textBaseline","font","getPixels","getPixelsV","makeParticles","animate","positions","length","push","Math","pow","sin","x","y","addParticles","nta","removeParticles","newArr","slice","keyword","clearRect","fillText","measureText","imgData","getImageData","buffer32","Uint32Array","data","buffer","diff","forEach","p","setState","animateParticles","move","mx","my","draw","changeWord","homeX","homeY","animation","requestAnimationFrame","tweenSize","t","l","to","radius","getX","getY","delay","yoyo","repeat","easing","easeInOut","resetTween","killAll","onMouseMove","e","clientX","offsetLeft","clientY","offsetTop","onResize","setCanvasState","onScroll","props","setHasBackground","clearTimeout","setTimeout","onScrollToBottom","updateWord","onScrollUp","updateCanvas","location","initWord","getBgText","prevProps","addEventListener","color"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { TweenMax, Sine } from 'gsap';\n\nimport Particle from './Particle';\nimport debounce from '../functions/debounce';\nimport { isMobileDevice } from '../functions/browser-detect';\n\nclass TextCanvas extends Component {\n  state = {\n    isMobile: isMobileDevice(),\n    width: window.innerWidth,\n    height: window.innerHeight,\n    dpi: 2,\n    words: [\n      '장수영',\n      '나는',\n      '마르케',\n      '오디세이',\n      '트렁크',\n      '이것저것',\n      '다음',\n    ],\n    size: {\n      max: 25,\n      grid: 23,\n      min: 21,\n    },\n    fontSize: '140vh',\n    fontFamily: 'Black Han Sans',\n    i: 0,\n    vertical: false,\n    timer: null,\n  }\n\n  init = () => {\n    this.canvas = document.getElementById('canvas');\n    this.ctx = this.canvas.getContext('2d');\n\n    this.txtCanv = document.createElement('canvas');\n    this.txtCtx = this.txtCanv.getContext('2d');\n    this.txtCtx.fillStyle = 'black';\n  }\n\n  setValues = () => {\n    this.canvas.width = this.state.width * this.state.dpi;\n    this.canvas.height = this.state.height * this.state.dpi;\n\n    this.particles = [];\n\n    this.txtCanv.width = this.canvas.width;\n    this.txtCanv.height = this.canvas.height;\n    this.txtCtx.textBaseline = 'middle';\n    this.txtCtx.font = `${this.state.fontSize} ${this.state.fontFamily}`;\n\n    if (!this.state.vertical) {\n      this.getPixels(this.state.words[this.state.i]);\n    } else {\n      this.getPixelsV(this.state.words[this.state.i]);\n    }\n\n    this.makeParticles();\n    this.animate();\n  }\n\n  makeParticles = () => {\n    for (let i = 0; i < this.positions.length; i++) {\n      if (!!this.positions[i]) {\n        this.particles.push(\n          new Particle(\n            this.state.width,\n            Math.pow(i, 1.3) * Math.sin(i),\n            this.positions[i].x,\n            this.positions[i].y,\n            this.ctx,\n            this.state.size.min,\n          )\n        )\n      }\n    }\n  }\n\n  addParticles = () => {\n    const nta = this.positions.length - this.particles.length;\n    for (let i = 0; i <= nta; i++) {\n      this.particles.push(\n        new Particle(\n          this.canvas.width / 2,\n          i + this.canvas.height / 2,\n          this.canvas.width / 2,\n          i + this.canvas.height / 2,\n          this.ctx,\n          this.state.size.min,\n        )\n      )\n    }\n  }\n\n  removeParticles = () => {\n    const newArr = this.particles.slice(0, this.positions.length);\n    this.particles = newArr;\n  }\n\n  getPixels = (keyword) => {\n    this.txtCtx.clearRect(0, 0, this.txtCanv.width, this.txtCanv.height);\n    this.txtCtx.fillText(keyword, this.txtCanv.width / 2 - this.txtCtx.measureText(keyword).width / 2, this.txtCanv.height / 2);\n\n    const imgData = this.txtCtx.getImageData(0, 0, this.txtCanv.width, this.txtCanv.height);\n    const buffer32 = new Uint32Array(imgData.data.buffer);\n\n    this.positions = [];\n    for (let y = 0; y < this.txtCanv.height; y += this.state.size.grid) {\n      for (let x = 0; x < this.txtCanv.width; x += this.state.size.grid) {\n        if (buffer32[y * this.txtCanv.width + x]) {\n          this.positions.push({ x, y });\n        }\n      }\n    }\n\n    const diff = (this.canvas.height - this.positions[this.positions.length - 1].y - this.positions[0].y) / 2;\n    this.positions.forEach((p) => {\n      p.y += diff;\n    });\n  }\n\n  getPixelsV = (keyword) => {\n    this.txtCtx.clearRect(0, 0, this.txtCanv.width, this.txtCanv.height);\n    this.txtCtx.textBaseline = 'top';\n\n    let p;\n    if (keyword.length >= 3) {\n      this.setState({\n        fontSize: `${110 / keyword.length * this.state.dpi}vh`\n      }, () => {\n        this.txtCtx.font = `${this.state.fontSize} ${this.state.fontFamily}`;\n      });\n      p = 1 / keyword.length;\n    } else {\n      this.setState({\n        fontSize: `${80 / keyword.length * this.state.dpi}vh`\n      }, () => {\n        this.txtCtx.font = `${this.state.fontSize} ${this.state.fontFamily}`;\n      });\n      p = 0.4;\n    }\n\n    for (let i = 0; i < keyword.length; i++) {\n      this.txtCtx.fillText(\n        keyword[i],\n        i * (this.txtCanv.width / ((keyword.length + 1) / 2) - this.txtCtx.measureText(keyword[i]).width / 2),\n        i * (this.txtCanv.height * p),\n      );\n    }\n\n    const imgData = this.txtCtx.getImageData(0, 0, this.txtCanv.width, this.txtCanv.height);\n    const buffer32 = new Uint32Array(imgData.data.buffer);\n\n    this.positions = [];\n    for (let y = 0; y < this.txtCanv.height; y += this.state.size.grid) {\n      for (let x = 0; x < this.txtCanv.width; x += this.state.size.grid) {\n        if (buffer32[y * this.txtCanv.width + x]) {\n          this.positions.push({ x, y });\n        }\n      }\n    }\n\n    let diff;\n    if (keyword.length >= 3) {\n      diff = this.positions[0].y / -1;\n    } else {\n      diff = (this.canvas.height - this.positions[this.positions.length - 1].y - this.positions[0].y) / 2;\n    }\n    this.positions.forEach((p) => {\n      p.y += diff;\n    });\n  }\n\n  animateParticles = () => {\n    this.positions.forEach((p, i) => {\n      this.particles[i].move(this.mx, this.my);\n      this.particles[i].draw();\n    });\n  }\n\n  changeWord = () => {\n    // TweenMax.killAll(true);\n\n    if (!this.state.vertical) {\n      this.getPixels(this.state.words[this.state.i]);\n    } else {\n      this.getPixelsV(this.state.words[this.state.i]);\n    }\n\n    if (this.positions.length > this.particles.length) {\n      this.addParticles();\n    } else {\n      this.removeParticles();\n    }\n\n    this.positions.forEach((p, i) => {\n      this.particles[i].homeX = p.x;\n      this.particles[i].homeY = p.y;\n    });\n\n    // this.tweenSize();\n  }\n\n  animate = debounce(() => {\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.animateParticles();\n    this.animation = requestAnimationFrame(this.animate);\n  }, 1000 / 60)\n\n  tweenSize = () => {\n    const t = 3.5,\n          l = this.particles.length;\n    this.particles.forEach((p, i) => {\n      TweenMax.to(p, t, {\n        radius: this.state.size.max,\n        homeX: !this.state.isMobile ? p.getX() + 20 : p.getX() + 10,\n        homeY: !this.state.isMobile ? p.getY() + 30 : p.getY() + 15,\n        delay: t / l * i,\n        yoyo: true,\n        repeat: -1,\n        easing: Sine.easeInOut,\n      });\n    });\n  }\n\n  resetTween = () => {\n    this.setValues();\n    TweenMax.killAll(true);\n    this.tweenSize();\n  }\n\n  onMouseMove = (e) => {\n    this.mx = (e.clientX - this.canvas.offsetLeft) * this.state.dpi;\n    this.my = (e.clientY - this.canvas.offsetTop) * this.state.dpi;\n  }\n\n  // Reset Canvas State on resize\n  onResize = () => {\n    if (this.state.width !== window.innerWidth ||\n       (this.state.height !== window.innerHeight && this.state.width > 768)\n    ) {\n      this.setCanvasState();\n    }\n  }\n\n  // Canvas State Set Function\n  // Breakpoint sizing updates\n  setCanvasState = () => {\n    this.setState({\n      width: window.innerWidth,\n      height: window.innerHeight,\n    }, () => {\n      if (this.state.width >= 1600) {\n        this.setState({\n          size: {\n            max: 14.5 * this.state.dpi,\n            grid: 14 * this.state.dpi,\n            min: 13.5 * this.state.dpi,\n          },\n          fontSize: `${70 * this.state.dpi}vh`,\n          vertical: false,\n        }, this.setValues);\n      } else if (this.state.width < 1600 && this.state.width >= 1080) {\n        this.setState({\n          size: {\n            max: 12 * this.state.dpi,\n            grid: 11.5 * this.state.dpi,\n            min: 11 * this.state.dpi,\n          },\n          fontSize: `${65 * this.state.dpi}vh`,\n          vertical: false,\n        }, this.setValues);\n      } else if (this.state.width < 1080 && this.state.width >= 768) {\n        this.setState({\n          size: {\n            max: 9.5 * this.state.dpi,\n            grid: 9 * this.state.dpi,\n            min: 8.5 * this.state.dpi,\n          },\n          fontSize: `${60 * this.state.dpi}vh`,\n          vertical: false,\n        }, this.setValues);\n      } else if (this.state.width < 768 && this.state.width >= 480) {\n        this.setState({\n          size: {\n            max: 7.5 * this.state.dpi,\n            grid: 7 * this.state.dpi,\n            min: 6.5 * this.state.dpi,\n          },\n          fontSize: `${60 * this.state.dpi}vh`,\n          vertical: false,\n        }, this.setValues);\n      } else {\n        this.setState({\n          size: {\n            max: 7.5 * this.state.dpi,\n            grid: 7 * this.state.dpi,\n            min: 6.5 * this.state.dpi,\n          },\n          fontSize: `${40 * this.state.dpi}vh`,\n          vertical: true,\n        }, this.setValues);\n      }\n    });\n  }\n\n  onScroll = () => {\n    this.props.setHasBackground(true);\n    clearTimeout(this.state.timer);\n\n    this.setState({\n      timer: setTimeout(() => {\n        this.props.setHasBackground(false);\n        this.resetTween();\n      }, 7500)\n    });\n  }\n\n  onScrollToBottom = () => {\n    this.updateWord(6, 0);\n  }\n\n  onScrollUp = () => {\n    this.updateCanvas(this.props.location, 0);\n  }\n\n  initWord = () => {\n    switch(this.props.location) {\n      default:\n      case '/':\n        this.setState({ i: 0 });\n        break;\n      case '/about':\n        this.setState({ i: 1 });\n        break;\n      case '/marquee-sports':\n        this.setState({ i: 2 });\n        break;\n      case '/odyssey':\n        this.setState({ i: 3 });\n        break;\n      case '/trunk-club':\n        this.setState({ i: 4 });\n        break;\n      case '/ar-vr':\n        this.setState({ i: 5 });\n        break;\n    }\n  }\n\n  updateWord = (i, t) => {\n    this.setState({ i }, () => {\n      this.props.getBgText(this.state.words[this.state.i]);\n      setTimeout(() => {\n        this.changeWord();\n      }, t);\n    });\n  }\n\n  updateCanvas = (location, t) => {\n    switch(location) {\n      default:\n      case '/':\n        this.updateWord(0, t);\n        break;\n      case '/about':\n        this.updateWord(1, t);\n        break;\n      case '/marquee-sports':\n        this.updateWord(2, t);\n        break;\n      case '/odyssey':\n        this.updateWord(3, t);\n        break;\n      case '/trunk-club':\n        this.updateWord(4, t);\n        break;\n      case '/etc':\n        this.updateWord(5, t);\n        break;\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.location !== this.props.location) {\n      this.updateCanvas(this.props.location, 250);\n    }\n  }\n\n  componentDidMount() {\n    this.init();\n    this.initWord();\n\n    setTimeout(() => {\n      this.updateCanvas(this.props.location);\n      this.setCanvasState();\n    }, 1500);\n\n    window.addEventListener('resize', debounce(this.onResize, 1000 / 5));\n\n    if (!this.state.isMobile) {\n      window.addEventListener('mousemove', this.onMouseMove);\n      window.addEventListener('scroll', debounce(this.onScroll, 1000 / 30));\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"canvas\">\n        <div style={{\n          fontFamily: 'Black Han Sans',\n          fontSize: '1px',\n          color: '#EFEFEF',\n        }}>\n          장수영 나는 마르케 오디세이 트렁크 이것저것 다음\n        </div>\n        <canvas\n          id=\"canvas\"\n          className=\"shared__canvas\">\n          {this.state.words[this.state.i]}\n        </canvas>\n      </div>\n    )\n  }\n}\n\nexport default TextCanvas;\n"]},"metadata":{},"sourceType":"module"}